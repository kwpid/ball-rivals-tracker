<!DOCTYPE html>
<html>
<head>
  <title>Player Profile - Ball Rivals Tracker</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --text-primary: #c9d1d9;
      --text-secondary: #8b949e;
      --accent: #58a6ff;
      --border: #30363d;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 3rem 1.5rem;
      background: var(--bg-secondary);
      border-radius: 12px;
      box-shadow: 0 4px 32px 0 rgba(20,20,20,0.18);
      border: 1.5px solid var(--border);
      margin-top: 3rem;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-bottom: 2.5rem;
    }

    .back-button {
      color: var(--text-secondary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: color 0.2s;
      font-size: 1.1rem;
      font-weight: 500;
    }

    .back-button:hover {
      color: var(--accent);
    }

    .profile-header {
      display: flex;
      gap: 2.2rem;
      margin-bottom: 3rem;
      align-items: center;
    }

    .avatar {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background: var(--border);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 16px 0 rgba(20,20,20,0.15);
      border: 3px solid var(--bg-secondary);
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      display: block;
    }

    .profile-info {
      flex: 1;
      min-width: 0;
    }

    .username {
      font-size: 2.1rem;
      margin-bottom: 0.5rem;
      font-weight: 700;
      letter-spacing: -1px;
      color: var(--text-primary);
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    .level {
      color: var(--text-secondary);
      font-size: 1.1rem;
      font-weight: 500;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    .stat-card {
      background: var(--bg-primary);
      border: 1.5px solid var(--border);
      border-radius: 10px;
      padding: 1.5rem 1.2rem 1.5rem 1.5rem;
      box-shadow: 0 1px 8px 0 rgba(20,20,20,0.10);
      transition: box-shadow 0.18s, border-color 0.18s;
    }

    .stat-card:hover {
      box-shadow: 0 4px 16px 0 rgba(88,166,255,0.10);
      border-color: var(--accent);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .stat-title {
      color: var(--text-secondary);
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .stat-value {
      font-size: 2.1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-top: 0.2rem;
    }

    .elo-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.95rem;
      font-weight: 600;
      margin-left: 0.5rem;
      letter-spacing: 0.5px;
    }

    .elo-bronze {
      background: #cd7f32;
      color: white;
    }

    .elo-silver {
      background: #c0c0c0;
      color: white;
    }

    .elo-gold {
      background: #ffd700;
      color: black;
    }

    .elo-platinum {
      background: #e5e4e2;
      color: black;
    }

    .elo-diamond {
      background: #b9f2ff;
      color: black;
    }

    .elo-master {
      background: #9370db;
      color: white;
    }

    .elo-grandmaster {
      background: #ff4500;
      color: white;
    }

    .winrate {
      font-size: 1.2rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      font-weight: 500;
    }

    .winrate.positive {
      color: #3fb950;
    }

    .winrate.negative {
      color: #f85149;
    }

    .stat-trend {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-secondary);
      font-size: 0.97rem;
      font-weight: 500;
    }

    .trend-up {
      color: #3fb950;
    }

    .trend-down {
      color: #f85149;
    }

    .recent-matches {
      background: var(--bg-primary);
      border: 1.5px solid var(--border);
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 1px 8px 0 rgba(20,20,20,0.08);
    }

    .section-title {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .match-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .match-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--bg-secondary);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      box-shadow: 0 1px 6px 0 rgba(20,20,20,0.07);
    }

    .match-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .match-result {
      font-weight: 600;
    }

    .win {
      color: #3fb950;
    }

    .loss {
      color: #f85149;
    }

    .match-details {
      color: var(--text-secondary);
      font-size: 0.97rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="/" class="back-button">
        <i class="fas fa-arrow-left"></i>
        Back to Search
      </a>
    </div>

    <div class="profile-header">
      <div class="avatar" id="robloxAvatar"></div>
      <div class="profile-info">
        <h1 class="username" id="username">Loading...</h1>
        <div class="level" id="level">Level: Loading...</div>
      </div>
    </div>

    <div class="stats-grid" id="statsGrid">
      <!-- Stats will be populated here -->
    </div>

    <div class="recent-matches">
      <h2 class="section-title">Recent Matches</h2>
      <div class="match-list" id="matchList">
        <!-- Matches will be populated here -->
      </div>
    </div>
  </div>

  <script>
    function getEloBadge(elo) {
      if (elo >= 2000) return 'elo-grandmaster';
      if (elo >= 1800) return 'elo-master';
      if (elo >= 1600) return 'elo-diamond';
      if (elo >= 1400) return 'elo-platinum';
      if (elo >= 1200) return 'elo-gold';
      if (elo >= 1000) return 'elo-silver';
      return 'elo-bronze';
    }

    function calculateWinrate(wins, losses) {
      const total = wins + losses;
      if (total === 0) return '0%';
      return `${Math.round((wins / total) * 100)}%`;
    }

    async function fetchRobloxAvatar(username) {
      try {
        // Get userId from username
        const userRes = await fetch(`https://api.roblox.com/users/get-by-username?username=${encodeURIComponent(username)}`);
        const userData = await userRes.json();
        if (!userData.Id) return null;
        // Get avatar image
        const avatarRes = await fetch(`https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${userData.Id}&size=150x150&format=Png&isCircular=true`);
        const avatarData = await avatarRes.json();
        if (avatarData.data && avatarData.data[0] && avatarData.data[0].imageUrl) {
          return avatarData.data[0].imageUrl;
        }
        return null;
      } catch (e) {
        return null;
      }
    }

    async function loadProfile() {
      const username = window.location.pathname.split('@')[1];
      if (!username) return;

      try {
        const res = await fetch(`/getstats?username=${encodeURIComponent(username)}`);
        if (!res.ok) throw new Error('Profile not found');
        const data = await res.json();

        // Update profile header
        document.getElementById('username').textContent = data.username;
        document.getElementById('level').textContent = `Level: ${data.level || 'N/A'}`;
        
        const stats = data.stats;
        const winrate = calculateWinrate(stats.Wins, stats.Losses);
        const isPositiveWinrate = stats.Wins > stats.Losses;

        // Fetch and set ROBLOX avatar
        const avatarUrl = await fetchRobloxAvatar(data.username);
        const avatarDiv = document.getElementById('robloxAvatar');
        if (avatarUrl) {
          avatarDiv.innerHTML = `<img src="${avatarUrl}" alt="${data.username}'s ROBLOX Avatar">`;
        } else {
          avatarDiv.innerHTML = `<i class='fas fa-user fa-4x' style='color:var(--text-secondary);'></i>`;
        }

        // Update stats grid
        const statsGrid = document.getElementById('statsGrid');
        statsGrid.innerHTML = `
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">1v1 Rating</div>
            </div>
            <div class="stat-value">
              ${stats.ELO_1v1}
              <span class="elo-badge ${getEloBadge(stats.ELO_1v1)}">${getEloBadge(stats.ELO_1v1).split('-')[1].toUpperCase()}</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Wins</div>
            </div>
            <div class="stat-value">${stats.Wins}</div>
            <div class="winrate ${isPositiveWinrate ? 'positive' : 'negative'}">
              Win Rate: ${winrate}
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Current Streak</div>
            </div>
            <div class="stat-value">${stats.CurrentStreak}</div>
            <div class="stat-trend">
              Best: ${stats.HighestStreak}
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-title">Team Ratings</div>
            </div>
            <div class="stat-value">
              <div>2v2: ${stats.ELO_2v2}</div>
              <div>3v3: ${stats.ELO_3v3}</div>
              <div>4v4: ${stats.ELO_4v4}</div>
            </div>
          </div>
        `;

        // Remove recent matches section since we don't have that data
        document.querySelector('.recent-matches').style.display = 'none';
      } catch (err) {
        console.error('Error loading profile:', err);
      }
    }

    loadProfile();
  </script>
</body>
</html> 
